#!/bin/bash

base_dir=$(dirname $0)/..

CLASSPATH=$CLASSPATH:$base_dir/target/classes:../open-replicator/target/classes

for file in $base_dir/target/maxwell-*/*/lib/*.jar lib/*.jar target/dependency/*.jar
do
  if [[ "$@" == *--kafka0.9* ]] && [[ ! $file == "target/dependency/kafka-clients-$KAFKA_08_VERSION.jar" ]]; then
    CLASSPATH=$CLASSPATH:$file
  elif [[ ! "$@" == *--kafka0.9* ]] && [[ ! $file == "target/dependency/kafka-clients-$KAFKA_09_VERSION.jar" ]]; then
    CLASSPATH=$CLASSPATH:$file
  fi
done

if [ -z "$JAVA_HOME" ]; then
  JAVA="java"
else
  JAVA="$JAVA_HOME/bin/java"
fi

export LANG="en_US.UTF-8"

exec $JAVA -Dlog4j.shutdownCallbackRegistry=com.djdch.log4j.StaticShutdownCallbackRegistry -cp $CLASSPATH com.zendesk.maxwell.bootstrap.MaxwellBootstrapUtility "$@"
